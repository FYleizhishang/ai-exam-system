<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>iStudy AI æ™ºèƒ½åŠ©æ•™</title>
    <link rel="stylesheet" href="[https://unpkg.com/element-plus/dist/index.css](https://unpkg.com/element-plus/dist/index.css)" />
    <style>
        body { margin: 0; background: #f0f2f5; font-family: 'Helvetica Neue', Helvetica, 'PingFang SC', 'Hiragino Sans GB', 'Microsoft YaHei', 'å¾®è½¯é›…é»‘', Arial, sans-serif; }
        .chat-container { max-width: 800px; margin: 20px auto; background: white; border-radius: 12px; box-shadow: 0 4px 12px rgba(0,0,0,0.05); height: 90vh; display: flex; flex-direction: column; }
        .header { padding: 20px; border-bottom: 1px solid #eee; font-size: 18px; font-weight: bold; color: #333; display: flex; align-items: center; }
        .header img { width: 30px; height: 30px; margin-right: 10px; }
        .msg-list { flex: 1; overflow-y: auto; padding: 20px; background: #f9faFc; }
        .msg-item { display: flex; margin-bottom: 20px; }
        .msg-item.me { flex-direction: row-reverse; }
        .avatar { width: 40px; height: 40px; border-radius: 50%; background: #ddd; margin: 0 10px; flex-shrink: 0; display: flex; align-items: center; justify-content: center; font-size: 20px; }
        .msg-content { max-width: 70%; padding: 12px 16px; border-radius: 8px; font-size: 15px; line-height: 1.6; position: relative; word-break: break-all; }
        .me .msg-content { background: #409EFF; color: white; border-top-right-radius: 0; }
        .ai .msg-content { background: white; border: 1px solid #e4e7ed; color: #333; border-top-left-radius: 0; box-shadow: 0 2px 4px rgba(0,0,0,0.02); }
        .input-area { padding: 20px; border-top: 1px solid #eee; display: flex; gap: 10px; background: white; border-radius: 0 0 12px 12px; }
        /* Markdown æ ·å¼ç®€å•æ¨¡æ‹Ÿ */
        pre { background: #f4f4f5; padding: 10px; border-radius: 4px; overflow-x: auto; font-family: monospace; }
    </style>
</head>
<body>
<div id="app">
    <div class="chat-container">
        <div class="header">
            <span class="avatar" style="background: #67C23A; color: white;">ğŸ¤–</span>
            iStudy AI å…¨èƒ½åŠ©æ•™
            <el-tag type="success" size="small" style="margin-left: 10px;">DeepSeek V3 / Gemini</el-tag>
        </div>

        <div class="msg-list" ref="msgList">
            <div class="msg-item ai">
                <div class="avatar" style="background: #67C23A; color: white;">ğŸ¤–</div>
                <div class="msg-content">ä½ å¥½ï¼æˆ‘æ˜¯ä½ çš„ä¸“å± AI åŠ©æ•™ã€‚æˆ‘å¯ä»¥å¸®ä½ ï¼š<br>1. è§£æè€ƒè¯•é”™é¢˜<br>2. è§£é‡Šå¤æ‚çš„çŸ¥è¯†ç‚¹<br>3. ç¼–å†™ä»£ç ç¤ºä¾‹<br>è¯·é—®æœ‰ä»€ä¹ˆå¯ä»¥å¸®ä½ çš„å—ï¼Ÿ</div>
            </div>

            <div class="msg-item" :class="msg.role" v-for="(msg, index) in messages" :key="index">
                <div class="avatar" :style="msg.role === 'me' ? 'background:#409EFF;color:white' : 'background:#67C23A;color:white'">
                    {{ msg.role === 'me' ? 'æˆ‘' : 'ğŸ¤–' }}
                </div>
                <div class="msg-content" style="white-space: pre-wrap;">{{ msg.content }}</div>
            </div>

            <div class="msg-item ai" v-if="loading">
                <div class="avatar" style="background: #67C23A; color: white;">ğŸ¤–</div>
                <div class="msg-content">
                    <span class="loading-dot">.</span><span class="loading-dot">.</span><span class="loading-dot">.</span>
                </div>
            </div>
        </div>

        <div class="input-area">
            <el-input v-model="input" placeholder="è¾“å…¥ä½ çš„é—®é¢˜ï¼Œä¾‹å¦‚ï¼šå¸®æˆ‘è§£é‡Šä¸€ä¸‹å†’æ³¡æ’åº..." @keyup.enter="send"></el-input>
            <el-button type="primary" @click="send" :loading="loading">å‘é€</el-button>
        </div>
    </div>
</div>

<script src="[https://unpkg.com/vue@3/dist/vue.global.js](https://unpkg.com/vue@3/dist/vue.global.js)"></script>
<script src="[https://unpkg.com/element-plus/dist/index.full.js](https://unpkg.com/element-plus/dist/index.full.js)"></script>
<script src="[https://unpkg.com/axios/dist/axios.min.js](https://unpkg.com/axios/dist/axios.min.js)"></script>
<script>
    const { createApp, ref, nextTick } = Vue;
    const { ElMessage } = ElementPlus;

    const app = createApp({
        setup() {
            const input = ref('');
            const messages = ref([]);
            const loading = ref(false);
            const msgList = ref(null);

            const scrollToBottom = () => {
                nextTick(() => {
                    if (msgList.value) msgList.value.scrollTop = msgList.value.scrollHeight;
                });
            };

            const send = () => {
                const text = input.value.trim();
                if (!text) return;

                messages.value.push({ role: 'me', content: text });
                input.value = '';
                loading.value = true;
                scrollToBottom();

                const token = localStorage.getItem('token');
                if (!token) {
                    ElMessage.warning('è¯·å…ˆç™»å½•');
                    setTimeout(() => location.href = 'login.html', 1500);
                    return;
                }

                axios.post('/api/chat/ask', { question: text }, {
                    headers: { 'Authorization': token }
                }).then(res => {
                    if (res.data.code === 200) {
                        messages.value.push({ role: 'ai', content: res.data.answer });
                    } else {
                        ElMessage.error(res.data.msg);
                    }
                }).catch(e => {
                    ElMessage.error('AI è¿æ¥è¶…æ—¶');
                }).finally(() => {
                    loading.value = false;
                    scrollToBottom();
                });
            };

            return { input, messages, send, loading, msgList };
        }
    });
    app.use(ElementPlus);
    app.mount('#app');
</script>
<style>
    .loading-dot { animation: dot 1.5s infinite; opacity: 0; }
    .loading-dot:nth-child(1) { animation-delay: 0s; }
    .loading-dot:nth-child(2) { animation-delay: 0.5s; }
    .loading-dot:nth-child(3) { animation-delay: 1s; }
    @keyframes dot { 0% { opacity: 0; } 50% { opacity: 1; } 100% { opacity: 0; } }
</style>
</body>
</html>