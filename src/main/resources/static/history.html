<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <title>æˆ‘çš„æˆç»©å•</title>
  <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
  <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>
  <style>
    body { background: #f5f5f7; padding: 20px; }
    .score-card { background: white; border-radius: 12px; padding: 20px; margin-bottom: 15px; display: flex; justify-content: space-between; align-items: center; box-shadow: 0 2px 8px rgba(0,0,0,0.05); }
    .score-num { font-size: 24px; font-weight: bold; color: #007aff; }
    .diagnosis-text { white-space: pre-wrap; text-align: left; font-size: 14px; line-height: 1.6; color: #333; }
  </style>
</head>
<body>

<div class="container" style="max-width: 600px;">
  <div class="d-flex justify-content-between align-items-center mb-4">
    <h4 class="fw-bold m-0">ğŸ“ˆ å†å²æˆç»© & AI è¯Šæ–­</h4>
    <a href="dashboard.html" class="btn btn-sm btn-outline-secondary rounded-pill">è¿”å›ä¸»é¡µ</a>
  </div>

  <div id="list">
    <div class="text-center py-5"><div class="spinner-border text-primary"></div></div>
  </div>
</div>

<script>
  const user = localStorage.getItem("username");
  if(!user) location.href='/login.html';

  fetch('/api/my/history?u='+user).then(r=>r.json()).then(d => {
    if(d.length === 0) {
      document.getElementById('list').innerHTML = '<div class="text-center text-muted">æš‚æ— è€ƒè¯•è®°å½•</div>';
      return;
    }
    document.getElementById('list').innerHTML = d.map(s => `
            <div class="score-card">
                <div>
                    <h6 class="fw-bold mb-1">æœŸæœ«è€ƒè¯• (AIé˜…å·)</h6>
                    <small class="text-muted">${s.createTime ? s.createTime.replace('T',' ') : 'åˆšåˆš'}</small>
                </div>
                <div class="text-end">
                    <div class="score-num">${s.score}åˆ†</div>
                    <button class="btn btn-sm btn-primary rounded-pill mt-1" onclick="showDiag('${encodeURIComponent(s.aiDiagnosis || 'AI æ­£åœ¨ç”Ÿæˆä¸­...')}')">
                        âœ¨ æŸ¥çœ‹ AI è¯Šæ–­
                    </button>
                </div>
            </div>
        `).join('');
  });

  function showDiag(txt) {
    Swal.fire({
      title: 'ğŸ¤– AI å­¦ä¹ è¯Šæ–­æŠ¥å‘Š',
      html: `<div class="diagnosis-text">${decodeURIComponent(txt)}</div>`,
      width: 600,
      confirmButtonText: 'æˆ‘æ”¶åˆ°äº†'
    });
  }
</script>
</body>
</html>