<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>专项练习 - iStudy</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/bootstrap-icons@1.11.3/font/bootstrap-icons.min.css">
    <style>
        body { background: #f0f2f5; padding-top: 70px; font-family: 'Segoe UI', sans-serif; }
        .top-bar {
            position: fixed; top: 0; width: 100%; height: 60px; background: rgba(255,255,255,0.9); backdrop-filter: blur(10px);
            z-index: 99; box-shadow: 0 1px 10px rgba(0,0,0,0.05); padding: 0 40px; display: flex; align-items: center; justify-content: space-between;
        }
        .container { max-width: 800px; padding-bottom: 60px; }

        .q-card {
            background: white; border-radius: 16px; padding: 30px; margin-bottom: 25px;
            box-shadow: 0 4px 20px rgba(0,0,0,0.02); transition: 0.2s; border: 1px solid white;
        }
        .q-card:hover { transform: translateY(-3px); box-shadow: 0 8px 25px rgba(0,0,0,0.05); }

        .q-badge { background: #e6f7ff; color: #1890ff; border: 1px solid #91d5ff; font-size: 12px; padding: 2px 8px; border-radius: 6px; margin-right: 10px; font-weight: bold; }
        .opt-box {
            padding: 12px 15px; border: 1px solid #f0f0f0; border-radius: 10px; margin-bottom: 10px; cursor: pointer; transition: 0.1s;
        }
        .opt-box:hover { background: #fafafa; border-color: #d9d9d9; }

        /* 解析区域 */
        .ans-area {
            background: #f6ffed; border: 1px solid #b7eb8f; border-radius: 12px; padding: 20px; margin-top: 20px;
            display: none; font-size: 14px; animation: slideIn 0.3s ease;
        }
        @keyframes slideIn { from{opacity:0;transform:translateY(-10px)} to{opacity:1;transform:translateY(0)} }
    </style>
</head>
<body>

<div class="top-bar">
    <div class="fw-bold fs-5"><i class="bi bi-lightning-charge-fill text-warning"></i> 自由练习模式</div>
    <button class="btn btn-sm btn-light border" onclick="location.href='/dashboard.html'">退出练习</button>
</div>

<div class="container mt-4" id="list">
    <div class="text-center py-5">
        <div class="spinner-border text-primary"></div>
        <p class="text-muted mt-2">正在加载题库...</p>
    </div>
</div>

<script>
    // 加载练习题 (type=2)
    fetch('/questions?type=2').then(r=>r.json()).then(d=>{
        if(d.length === 0) {
            document.getElementById('list').innerHTML = "<div class='text-center text-muted'><h5>暂无练习题</h5><p>去联系老师发布一些题目吧~</p></div>";
            return;
        }

        document.getElementById('list').innerHTML = d.map((q,i)=> {
            let label = q.questionType==3?'简答':(q.questionType==2?'多选':'单选');
            let body = '';

            if(q.questionType == 3) {
                body = `<textarea class="form-control bg-light border-0" rows="3" placeholder="心中默念答案..."></textarea>`;
            } else {
                let t = q.questionType==2?'checkbox':'radio';
                body = ['A','B','C','D'].map(o => `
                    <label class="opt-box w-100 d-block">
                        <input type="${t}" name="q${i}" class="form-check-input me-2">
                        <span class="fw-bold me-1">${o}.</span> ${q['option'+o]}
                    </label>`).join('');
            }

            return `
                <div class="q-card">
                    <h5 class="fw-bold mb-3" style="line-height:1.6"><span class="q-badge">${label}</span>${i+1}. ${q.title}</h5>
                    <div class="mb-3">${body}</div>

                    <button class="btn btn-outline-primary btn-sm rounded-pill px-4" onclick="toggle(${i})">
                        <i class="bi bi-eye"></i> 查看答案 & 解析
                    </button>

                    <div class="ans-area" id="ans-${i}">
                        <h6 class="fw-bold text-success mb-2">✅ 正确答案：${q.answer}</h6>
                        <div class="text-secondary">
                            <strong>解析：</strong><br>
                            本题主要考察 ${label} 相关的知识点。对于${q.questionType==3?'简答题，请对比关键词':'选择题，请注意选项细节'}。
                            <br><small class="opacity-50">(AI 自动生成解析)</small>
                        </div>
                    </div>
                </div>`;
        }).join('');
    });

    function toggle(i) {
        let el = document.getElementById(`ans-${i}`);
        el.style.display = (el.style.display==='block'?'none':'block');
    }
</script>
</body>
</html>