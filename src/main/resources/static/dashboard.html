<!DOCTYPE html>
<html lang="zh-CN">
<head>
    <meta charset="UTF-8">
    <title>å­¦ç”Ÿå­¦ä¹ ä¸­å¿ƒ</title>
    <link rel="stylesheet" href="https://unpkg.com/element-plus/dist/index.css" />
    <style>
        body { margin: 0; background: #f0f2f5; font-family: sans-serif; }
        .nav { background: #fff; height: 60px; padding: 0 40px; display: flex; align-items: center; justify-content: space-between; box-shadow: 0 2px 8px rgba(0,0,0,0.06); }
        .main { width: 1200px; margin: 20px auto; display: flex; gap: 20px; }
        .left-col { width: 300px; }
        .right-col { flex: 1; }
        .user-card { background: #fff; padding: 30px; text-align: center; border-radius: 8px; }
        .stat-row { display: flex; justify-content: space-around; margin-top: 20px; color: #666; }
        .stat-val { font-size: 20px; font-weight: bold; color: #1890ff; display: block; }
        .exam-item { display: flex; justify-content: space-between; align-items: center; padding: 15px; border-bottom: 1px solid #f0f0f0; background: #fff; transition: 0.3s; }
        .exam-item:hover { background: #fafafa; }
    </style>
</head>
<body>
<div id="app">
    <div class="nav">
        <div style="font-size: 20px; font-weight: bold; color: #1890ff;">iStudy å­¦ä¹ å¹³å°</div>
        <el-button type="danger" link @click="logout">é€€å‡º</el-button>
    </div>

    <div class="main">
        <div class="left-col">
            <div class="user-card">
                <el-avatar :size="80" :src="user.avatar || 'https://cube.elemecdn.com/0/88/03b0d39583f48206768a7534e55bcpng.png'"></el-avatar>
                <h3 style="margin: 10px 0">{{ user.name || user.username || 'åŒå­¦' }}</h3>
                <el-tag size="small">å­¦ç”Ÿè´¦å·</el-tag>
                <div class="stat-row">
                    <div><span class="stat-val">{{ user.points || 0 }}</span>ç§¯åˆ†</div>
                    <div><span class="stat-val">Lv.1</span>ç­‰çº§</div>
                </div>
            </div>
        </div>

        <div class="right-col">
            <el-card header="ğŸ”¥ æœ€æ–°å‘å¸ƒçš„è€ƒè¯•">
                <div v-if="papers.length === 0" style="padding: 40px; text-align: center; color: #999;">
                    <el-empty description="æš‚æ— è€ƒè¯•ï¼Œè¯·æé†’è€å¸ˆå‘å¸ƒ"></el-empty>
                </div>
                <div v-for="p in papers" :key="p.id" class="exam-item">
                    <div>
                        <div style="font-weight: bold; font-size: 16px; margin-bottom: 5px;">{{ p.title }}</div>
                        <div style="color: #999; font-size: 13px;">
                            <el-icon style="vertical-align: middle"><Timer /></el-icon>
                            æ—¶é•¿: {{ p.duration }}åˆ†é’Ÿ | æ€»åˆ†: {{ p.totalScore }}
                        </div>
                    </div>
                    <el-button type="primary" @click="startExam(p.id)">å‚åŠ è€ƒè¯•</el-button>
                </div>
            </el-card>
        </div>
    </div>
</div>

<script src="https://unpkg.com/vue@3/dist/vue.global.js"></script>
<script src="https://unpkg.com/element-plus/dist/index.full.js"></script>
<script src="https://unpkg.com/@element-plus/icons-vue/dist/index.iife.min.js"></script>
<script src="https://unpkg.com/axios/dist/axios.min.js"></script>

<script>
    const { createApp, ref, onMounted } = Vue;
    const app = createApp({
        setup() {
            const user = ref({});
            const papers = ref([]);

            // åŠ è½½ç”¨æˆ·
            const loadUser = () => {
                axios.get('/api/user/current').then(res => {
                    if(res.data) user.value = res.data;
                    else location.href = 'login.html';
                }).catch(() => {
                    // å¦‚æœåç«¯è¿˜æ²¡é€šï¼Œå…ˆç»™ä¸ªå‡æ•°æ®å±•ç¤ºç•Œé¢ï¼Œé˜²æ­¢ä¹±ç å“åˆ°ä½ 
                    user.value = { name: 'æ¼”ç¤ºå­¦ç”Ÿ', points: 100 };
                });
            };

            // åŠ è½½è¯•å·
            const loadPapers = () => {
                axios.get('/api/student/paper/list').then(res => {
                    papers.value = res.data;
                });
            };

            const startExam = (id) => {
                location.href = 'student_exam.html?id=' + id;
            };

            const logout = () => {
                axios.post('/logout').then(() => location.href = 'login.html');
            };

            onMounted(() => {
                loadUser();
                loadPapers();
            });

            return { user, papers, startExam, logout };
        }
    });
    // æ³¨å†Œå›¾æ ‡
    for (const [key, component] of Object.entries(ElementPlusIconsVue)) {
        app.component(key, component);
    }
    app.use(ElementPlus);
    app.mount('#app');
</script>
</body>
</html>